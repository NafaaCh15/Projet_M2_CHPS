# =============================================================================
# PROJET M2 - MAKEFILE POUR PARTIE 2 (SMA C/C++)
# =============================================================================

# Compilateurs et options
CC = gcc
CXX = g++
CFLAGS = -std=c99 -O3 -Wall -Wextra -march=native
CXXFLAGS = -std=c++17 -O3 -Wall -Wextra -march=native
LDFLAGS = -lm

# Fichiers sources et exÃ©cutables
SRC_C = SMA_C_SEIRS.c
SRC_CPP = SMA_CPP_SEIRS.cpp
TARGET_C = sma_c
TARGET_CPP = sma_cpp

# =============================================================================
# RÃˆGLES DE COMPILATION
# =============================================================================

.PHONY: all clean help c cpp python run-c run-cpp run-python run-all

all: c cpp
	@echo ""
	@echo "âœ… Compilation terminÃ©e avec succÃ¨s"
	@echo ""
	@echo "ExÃ©cuter les simulations :"
	@echo "  make run-c      : Lancer SMA C (30 rÃ©plications)"
	@echo "  make run-cpp    : Lancer SMA C++ (30 rÃ©plications)"
	@echo "  make run-python : Lancer SMA Python (30 rÃ©plications)"
	@echo "  make run-all    : Lancer TOUS les SMA (90 fichiers CSV)"

# Compilation C
c: $(TARGET_C)

$(TARGET_C): $(SRC_C)
	@echo "ðŸ”¨ Compilation C..."
	$(CC) $(CFLAGS) -o $(TARGET_C) $(SRC_C) $(LDFLAGS)
	@echo "âœ… $(TARGET_C) compilÃ©"

# Compilation C++
cpp: $(TARGET_CPP)

$(TARGET_CPP): $(SRC_CPP)
	@echo "ðŸ”¨ Compilation C++..."
	$(CXX) $(CXXFLAGS) -o $(TARGET_CPP) $(SRC_CPP)
	@echo "âœ… $(TARGET_CPP) compilÃ©"

# ExÃ©cution C
run-c: $(TARGET_C)
	@echo "â–¶ï¸  Lancement SMA C (30 rÃ©plications)..."
	@echo ""
	./$(TARGET_C)

# ExÃ©cution C++
run-cpp: $(TARGET_CPP)
	@echo "â–¶ï¸  Lancement SMA C++ (30 rÃ©plications)..."
	@echo ""
	./$(TARGET_CPP)

# ExÃ©cution Python
run-python:
	@echo "â–¶ï¸  Lancement SMA Python (30 rÃ©plications)..."
	@echo ""
	python3 SMA_Python_SEIRS.py

# ExÃ©cution de tous les SMA (C, C++, Python)
run-all: all
	@echo "ðŸš€ Lancement de TOUTES les simulations (90 fichiers CSV)"
	@echo ""
	@echo "==================== SMA C ===================="
	./$(TARGET_C)
	@echo ""
	@echo "==================== SMA C++ ===================="
	./$(TARGET_CPP)
	@echo ""
	@echo "==================== SMA PYTHON ===================="
	python3 SMA_Python_SEIRS.py
	@echo ""
	@echo "âœ… TOUTES LES SIMULATIONS TERMINÃ‰ES"
	@echo ""
	@echo "Fichiers gÃ©nÃ©rÃ©s :"
	@echo "  - results_c/       : 30 fichiers CSV (C)"
	@echo "  - results_cpp/     : 30 fichiers CSV (C++)"
	@echo "  - results_python/  : 30 fichiers CSV (Python)"
	@echo ""
	@echo "Prochaine Ã©tape : Analyse statistique (Jupyter Notebook)"

# Nettoyage
clean:
	@echo "ðŸ§¹ Nettoyage..."
	rm -f $(TARGET_C) $(TARGET_CPP) *.o
	rm -rf results_c/ results_cpp/ results_python/
	@echo "âœ… Nettoyage terminÃ©"

# Nettoyage partiel (garde les rÃ©sultats)
clean-bin:
	@echo "ðŸ§¹ Nettoyage des exÃ©cutables..."
	rm -f $(TARGET_C) $(TARGET_CPP) *.o
	@echo "âœ… ExÃ©cutables supprimÃ©s"

# Aide
help:
	@echo "==================================================="
	@echo "MAKEFILE PROJET M2 - PARTIE 2 (SMA)"
	@echo "==================================================="
	@echo ""
	@echo "COMPILATION :"
	@echo "  make           : Compiler C et C++"
	@echo "  make c         : Compiler uniquement C"
	@echo "  make cpp       : Compiler uniquement C++"
	@echo ""
	@echo "EXÃ‰CUTION :"
	@echo "  make run-c     : Lancer SMA C (30 rÃ©plications)"
	@echo "  make run-cpp   : Lancer SMA C++ (30 rÃ©plications)"
	@echo "  make run-python: Lancer SMA Python (30 rÃ©plications)"
	@echo "  make run-all   : Lancer TOUS (C + C++ + Python)"
	@echo ""
	@echo "NETTOYAGE :"
	@echo "  make clean     : Supprimer tout (binaires + rÃ©sultats)"
	@echo "  make clean-bin : Supprimer uniquement les binaires"
	@echo ""
	@echo "AIDE :"
	@echo "  make help      : Afficher cette aide"
	@echo ""
	@echo "TEMPS ESTIMÃ‰ (30 rÃ©plications par langage) :"
	@echo "  - Python : ~30-60 minutes"
	@echo "  - C      : ~5-10 minutes"
	@echo "  - C++    : ~5-10 minutes"
	@echo "  - TOTAL  : ~40-80 minutes pour 90 fichiers CSV"
	@echo ""

# Stats rapides sur les fichiers gÃ©nÃ©rÃ©s
stats:
	@echo "ðŸ“Š Statistiques des fichiers gÃ©nÃ©rÃ©s :"
	@echo ""
	@echo "C :"
	@ls -lh results_c/*.csv 2>/dev/null | wc -l || echo "  Aucun fichier"
	@echo ""
	@echo "C++ :"
	@ls -lh results_cpp/*.csv 2>/dev/null | wc -l || echo "  Aucun fichier"
	@echo ""
	@echo "Python :"
	@ls -lh results_python/*.csv 2>/dev/null | wc -l || echo "  Aucun fichier"
	@echo ""
	@echo "TOTAL :"
	@find results_* -name "*.csv" 2>/dev/null | wc -l || echo "0"